
<!doctype html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.0/css/mdb.min.css" rel="stylesheet">

    <title>Lezioni alla Pari</title>

  </head>

  <body>

    <div id="overlay" style="display:none">Boh</div>

    <div class="row" aria-label="Ciao" id="main">
      <div class="col-sm-4 text-center" id="courses">
      </div>

      <div class="col-sm-4 text-center" id="topics">
      </div>

      <div class="col-sm-4 text-center" id="elements">
      </div>
    </div>

    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.0/js/mdb.min.js"></script>

    <script type="text/javascript">

      async function refreshCourses(){
        $("#courses").empty();
        $("#topics").empty();
        $("#elements").empty();
        coursesdict = await pywebview.api.list_courses()
        for (const course_id of coursesdict.message["rw"]){

          let div = document.createElement("div");
          div.className += " container";

          let button = document.createElement("button");
          button.className += " btn btn-indigo tn-outline-primary btn-lg btn-block waves-effect";
          button.id = course_id;
          course_name = await pywebview.api.get_course_attributes(course_id)
          button.innerHTML = course_name.message
          button.onclick = function(){refreshTopics(course_id)}

          div.appendChild(button);
          $("#courses").append(div);
        };
      }

      async function refreshTopics(course_id){
        $("#topics").empty();
        $("#elements").empty();
        topicsdict = await pywebview.api.list_topics(course_id)
        for (const topic_id of topicsdict.message){
          let div = document.createElement("div");
          div.className += " container";

          let button = document.createElement("button");
          button.className += " btn btn-indigo tn-outline-primary btn-lg btn-block waves-effect";
          button.id = topic_id;
          topic_name = await pywebview.api.get_topic_attributes({
            "course_id": course_id,
            "topic_id": topic_id
          });
          button.innerHTML = topic_name.message.name;
          button.onclick = function(){
            //alert(new Date(topic_name.message["creation date"]).toString()),
            refreshElements(topic_id, course_id)
          };

          div.appendChild(button);
          $("#topics").append(div);
        };
      }

      async function refreshElements(topic_id, course_id){
        $("#elements").empty();
        elementsdict = await pywebview.api.list_elements({"topic_id": topic_id, "course_id": course_id});
        for(const element_id of elementsdict.message){
          let div = document.createElement("div");
          div.className += " container";

          let button = document.createElement("button");
          button.className += " btn btn-indigo tn-outline-primary btn-lg btn-block waves-effect";
          button.id = element_id;
          element_properties = await pywebview.api.get_element_attributes({
            "element_id": element_id,
            "topic_id": topic_id,
            "course_id": course_id
          });
          button.innerHTML = element_properties.message.name;
          button.onclick = function(){
              //alert(element_name.message.type)
              //alert(new Date(element_name.message["creation date"]).toString());
              $("#main").fadeOut("slow", function(){
                $("#overlay").fadeIn("slow");
              });
            };

          div.appendChild(button);
          $("#elements").append(div);
        };
      }

      $(document).ready(function(){
        refreshCourses();
      })

    </script>

  </body>
</html>
